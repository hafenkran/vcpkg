diff --git a/src/msvcbuild.bat b/src/msvcbuild.bat
index bd0c4c5..1210fd2 100644
--- a/src/msvcbuild.bat
+++ b/src/msvcbuild.bat
@@ -67,6 +67,7 @@ buildvm -m folddef -o lj_folddef.h lj_opt_fold.c
 @shift
 @set LJCOMPILE=%LJCOMPILE% /Zi
 @set LJLINK=%LJLINK% /debug
+@set DEBUG=1
 :NODEBUG
 @if "%1"=="amalg" goto :AMALGDLL
 @if "%1"=="static" goto :STATIC
@@ -76,6 +77,7 @@ buildvm -m folddef -o lj_folddef.h lj_opt_fold.c
 @if errorlevel 1 goto :BAD
 @goto :MTDLL
 :STATIC
+@if "%DEBUG%"=="1" set LJCOMPILE=%LJCOMPILE% /MTd
 %LJCOMPILE% lj_*.c lib_*.c
 @if errorlevel 1 goto :BAD
 %LJLIB% /OUT:%LJLIBNAME% lj_*.obj lib_*.obj
